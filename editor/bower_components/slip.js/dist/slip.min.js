/*! slip.js 1.0.0, Copyright 2014 Colin Clark | github.com/colinbdclark/slip.js */

var slip=slip||{};!function(){"use strict";"undefined"!=typeof module&&module.exports&&(module.exports=slip),slip.END=192,slip.ESC=219,slip.ESC_END=220,slip.ESC_ESC=221,slip.byteArray=function(a,b,c){return a instanceof ArrayBuffer?new Uint8Array(a,b,c):a},slip.expandByteArray=function(a){var b=new Uint8Array(2*a.length);return b.set(a),b},slip.sliceByteArray=function(a,b,c){var d=a.buffer.slice?a.buffer.slice(b,c):a.subarray(b,c);return new Uint8Array(d)},slip.encode=function(a,b){b=b||{},b.bufferPadding=b.bufferPadding||4,a=slip.byteArray(a,b.offset,b.byteLength);var c=a.length+b.bufferPadding+3&-4,d=new Uint8Array(c),e=1;d[0]=slip.END;for(var f=0;f<a.length;f++){e>d.length-3&&(d=slip.expandByteArray(d));var g=a[f];g===slip.END?(d[e++]=slip.ESC,g=slip.ESC_END):g===slip.ESC&&(d[e++]=slip.ESC,g=slip.ESC_ESC),d[e++]=g}return d[e]=slip.END,slip.sliceByteArray(d,0,e+1)},slip.Decoder=function(a){a="function"!=typeof a?a||{}:{onMessage:a},this.maxMessageSize=a.maxMessageSize||10485760,this.bufferSize=a.bufferSize||1024,this.msgBuffer=new Uint8Array(this.bufferSize),this.msgBufferIdx=0,this.onMessage=a.onMessage,this.onError=a.onError,this.escape=!1};var a=slip.Decoder.prototype;a.decode=function(a){a=slip.byteArray(a);for(var b,c=0;c<a.length;c++){var d=a[c];if(this.escape)d===slip.ESC_ESC?d=slip.ESC:d===slip.ESC_END&&(d=slip.END);else{if(d===slip.ESC){this.escape=!0;continue}if(d===slip.END){b=this.handleEnd();continue}}var e=this.addByte(d);e||this.handleMessageMaxError()}return b},a.handleMessageMaxError=function(){this.onError&&this.onError(this.msgBuffer.subarray(0),"The message is too large; the maximum message size is "+this.maxMessageSize/1024+"KB. Use a larger maxMessageSize if necessary."),this.msgBufferIdx=0,this.escape=!1},a.addByte=function(a){return this.msgBufferIdx>this.msgBuffer.length-1&&(this.msgBuffer=slip.expandByteArray(this.msgBuffer)),this.msgBuffer[this.msgBufferIdx++]=a,this.escape=!1,this.msgBuffer.length<this.maxMessageSize},a.handleEnd=function(){if(0!==this.msgBufferIdx){var a=slip.sliceByteArray(this.msgBuffer,0,this.msgBufferIdx);return this.onMessage&&this.onMessage(a),this.msgBufferIdx=0,a}}}();